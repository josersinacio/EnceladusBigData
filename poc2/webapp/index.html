<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Signika:wght@300;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
  <title>Enceladus Big Data</title>
</head>

<body>
  <section class="novoPedido--section">

    <h2 class="Signika--700">Solicitar Novo Relatório</h2>
    <div class="relatorioTipo">
      <label class="Signika--500">Tipo de Relatório: Mortalidade por queimadura</label>
    </div>
    <br>
    <form onsubmit="processar()" class="novoPedido--form">
      <label class="novoPedido--label Signika--300">
        Estado

        <select id="estadosSelect" required>
          <option>Selecione</option>
        </select>
      </label>
      
      <label class="novoPedido--label Signika--300">
        Data inicial

        <input id="dataInicialInput" type="date" min="2013-01-01" max="2019-12-31" required>
      </label>

      <label class="novoPedido--label Signika--300">
        Data final

        <input id="dataFinalInput" type="date" min="2013-01-01" max="2019-12-31" required>
      </label>

      <label class="novoPedido--label Signika--300">
        E-mail

        <input id="emailInput" type="email" required>
      </label>

      <button type="submit" class="Signika--500">Processar</button>
    </form>
  </section>

  <section class="relatoriosProcessados--section">
    <h2  class="Signika--700">Relatórios Processados</h2>

    <table class="relatoriosProcessados--table">

      <tr class="Signika--500">
        <th>Estado</th>
        <th>Data de Inicio</th>
        <th>Data de Fim</th>
        <th>Download</th>
      </tr>

      <tbody id="linhasProcessadas"></body>

    </table>
  </section>

  <footer class="Signika--500">
    <div>Como usar | Criado por </div>
    <div>&copy; Copyright 2021, Enceladus Big Data</div>
  </footer>

  <script>
    const baseUrl = 'http://ec2-3-21-234-58.us-east-2.compute.amazonaws.com:5000';

    window.addEventListener('load', async () => {
      const relatorios = await buscarRelatoriosProcessados();

      //responsePreview.innerHTML = JSON.stringify(relatorios, null, 2);
      
      relatorios.forEach(function (relatoriosProcessados){

        linhasProcessadas.innerHTML += `
        <tr>
        <td class="estadoProcessado Signika--300">${relatoriosProcessados.estado}</td>
        <td class="dataInicioProcessado Signika--300">${relatoriosProcessados.data_inicio}</td>
        <td class="dataFimProcessado Signika--300">${relatoriosProcessados.data_fim}</td>
        <td class="downloadProcessado Signika--300"><a href='${baseUrl+relatoriosProcessados.uri}'> Baixar PDF </a></td> 
        </tr>`;
      });

      for (const estado of getEstados()) {
        const estadoOption = document.createElement("option");

        estadoOption.value = estado.sigla;
        estadoOption.innerText = estado.nome;

        estadosSelect.appendChild(estadoOption);
      }
    })

    async function processar() {
    }


    async function buscarRelatoriosProcessados() {
      const response = await fetch(`${baseUrl}/relatorios/queimaduras/densidade-municipal-por-periodo/processados`);

      return response.json();
    }

    function getEstados() {
      return [
        {
          "nome": "Acre",
          "sigla": "AC",
          "observacao": "Localizado na Região Norte"
        },
        {
          "nome": "Alagoas",
          "sigla": "AL",
          "observacao": "Localizado na Região Nordeste"
        },
        {
          "nome": "Amapá",
          "sigla": "AP",
          "observacao": "Localizado na Região Norte"
        },
        {
          "nome": "Amazonas",
          "sigla": "AM",
          "observacao": "Localizado na Região Norte"
        },
        {
          "nome": "Bahia",
          "sigla": "BA",
          "observacao": "Localizado na Região Nordeste"
        },
        {
          "nome": "Ceará",
          "sigla": "CE",
          "observacao": "Localizado na Região Nordeste"
        },
        {
          "nome": "Distrito Federal",
          "sigla": "DF",
          "observacao": "Localizado na Região Centro-Oeste"
        },
        {
          "nome": "Espírito Santo",
          "sigla": "ES",
          "observacao": "Localizado na Região Sudeste"
        },
        {
          "nome": "Goiás",
          "sigla": "GO",
          "observacao": "Localizado na Região Centro-Oeste"
        },
        {
          "nome": "Maranhão",
          "sigla": "MA",
          "observacao": "Localizado na Região Nordeste"
        },
        {
          "nome": "Mato Grosso",
          "sigla": "MT",
          "observacao": "Localizado na Região Centro-Oeste"
        },
        {
          "nome": "Mato Grosso do Sul",
          "sigla": "MS",
          "observacao": "Localizado na Região Centro-Oeste"
        },
        {
          "nome": "Minas Gerais",
          "sigla": "MG",
          "observacao": "Localizado na Região Sudeste"
        },
        {
          "nome": "Pará",
          "sigla": "PA",
          "observacao": "Localizado na Região Norte"
        },
        {
          "nome": "Paraíba",
          "sigla": "PB",
          "observacao": "Localizado na Região Nordeste"
        },
        {
          "nome": "Paraná",
          "sigla": "PR",
          "observacao": "Localizado na Região Sul"
        },
        {
          "nome": "Pernambuco",
          "sigla": "PE",
          "observacao": "Localizado na Região Nordeste"
        },
        {
          "nome": "Piauí",
          "sigla": "PI",
          "observacao": "Localizado na Região Nordeste"
        },
        {
          "nome": "Rio de Janeiro",
          "sigla": "RJ",
          "observacao": "Localizado na Região Sudeste"
        },
        {
          "nome": "Rio Grande do Norte",
          "sigla": "RN",
          "observacao": "Localizado na Região Nordeste"
        },
        {
          "nome": "Rio Grande do Sul",
          "sigla": "RS",
          "observacao": "Localizado na Região Sul"
        },
        {
          "nome": "Rondônia",
          "sigla": "RO",
          "observacao": "Localizado na Região Norte"
        },
        {
          "nome": "Roraima",
          "sigla": "RR",
          "observacao": "Localizado na Região Norte"
        },
        {
          "nome": "Santa Catarina",
          "sigla": "SC",
          "observacao": "Localizado na Região Sul"
        },
        {
          "nome": "São Paulo",
          "sigla": "SP",
          "observacao": "Localizado na Região Sudeste"
        },
        {
          "nome": "Sergipe",
          "sigla": "SE",
          "observacao": "Localizado na Região Nordeste"
        },
        {
          "nome": "Tocantins",
          "sigla": "TO",
          "observacao": "Localizado na Região Norte"
        }
      ]
    }
  </script>
</body>

</html>